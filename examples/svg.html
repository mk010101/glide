<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SVG</title>

    <style>

        * {
            box-sizing: border-box;
        }

        html, body {
            margin: 5px;
            padding: 10px;
            overflow: hidden;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        svg {
            width: 30%;
            border: 1px solid #3399FF;
        }

        .el {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: rgba(255, 95, 30, 0.78);
            /*top: -10px;*/
            /*left: -10px;*/
            margin-left: -10px;
        }


    </style>


</head>
<body>
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"
     y="0px"
     viewBox="-20 30 600 600" style="enable-background:new 0 0 600 600;" xml:space="preserve">
<circle id="circle-1" cx="270" cy="86" r="50" fill="#3399FF"/>
    <path id="path-1" d="M59.1,458.8C59.1,352.3,164.3,266,294.1,266
	C397.9,266,482,335,482,420.2c0,68.1-67.3,123.4-150.4,123.4c-66.4,0-120.3-44.2-120.3-98.7c0-43.6,43.1-79,96.2-79
	c42.5,0,77,28.3,77,63.2" fill="none" stroke="#3399FF" stroke-width="4"/>
    <rect id="rect-1" x="150" y="25" width="40" height="40" fill="rgba(0, 50, 255, .5)"/>
    <rect id="rect-2" x="29.5" y="346.5" width="100" height="100" fill="#3399FF"/>
</svg>

<div class="el"></div>
<div class="pt"></div>


<script type="module">

    import glide from "./libs/glide.esm.js";


    window.onload = () => {

        const el = document.querySelector(".el");

        const svg = document.querySelector("svg");
        const circle = document.querySelector("#circle-1");
        const rect1 = document.querySelector("#rect-1");
        const rect2 = document.querySelector("#rect-2");
        const symbol1 = document.querySelector("#symbol-1");
        const path = document.querySelector("#path-1");


        let a = glide.to(el)
        //.set({"ztransform-origin": "50% 50%", x:0, y:0})
        // .to(500, {x: 200}, {delay:500})
        //.to(2500, {path: path},
        //{delay:500})
            .on("end", () => {
                // console.log(a)
                console.log(a.keyframes[0].tgs[0].tweens[0]);
                console.log(rect2.getAttribute("transform-origin"))
            });


        //-----------------------------------------------------------------
        //rect1.setAttribute("transform", "rotate(45)")


        function getSvg(node) {
            let parent = node;
            while (parent instanceof SVGElement) {
                if (!(parent.parentNode instanceof SVGElement)) {
                    return parent;
                }
                parent = parent.parentNode;
            }
            return parent;
        }


        function getBox($svgEl, $el) {

            const svg = getSvg($svgEl);

            const bbSvgEl = $svgEl.getBoundingClientRect();
            const bbEl = $el.getBoundingClientRect();
            const bbSvg = svg.getBoundingClientRect();

            const viewBoxStr = svg.getAttribute("viewBox");

            let arrVB = [0, 0, bbSvgEl.width, bbSvgEl.height];

            if (viewBoxStr) {
                let arr = viewBoxStr.split(" ");
                arrVB = arr.map((v) => v = parseFloat(v));
            }

            return {
                svg: {
                    x: arrVB[0],
                    y: arrVB[1],
                    w: arrVB[2],
                    h: arrVB[3],
                    bbX: bbSvg.x,
                    bbY: bbSvg.y,
                    scaleX: bbSvg.width / arrVB[2],
                    scaleY: bbSvg.height / arrVB[3],
                },
                el: {
                    x: bbEl.x,
                    y: bbEl.y,
                    w: bbEl.width,
                    h: bbEl.height,
                }
            }
        }


        svg.style.width = "40%";

        let len = path.getTotalLength();
        let pos = path.getPointAtLength(len);

        // -------------------------------------
        let resEl = getBox(path, el);

        let elOffsetX = resEl.el.x;
        let elOffsetY = resEl.el.y;


        let x0 = (pos.x - resEl.svg.x) * resEl.svg.scaleX + resEl.svg.bbX - elOffsetX;
        let y0 = (pos.y - resEl.svg.y) * resEl.svg.scaleY + resEl.svg.bbY - elOffsetY;

        el.style.transform = `translate(${x0}px, ${y0}px)`;

        // -------------------------------------

        let resRect = getBox(path, rect1);

        let rectOffsetX = (resRect.el.x - resRect.svg.bbX) / resRect.svg.scaleX;
        let rectOffsetY = (resRect.el.y - resRect.svg.bbY) / resRect.svg.scaleY;

        console.log(resRect)

        let x1 = (pos.x) - resRect.svg.x - rectOffsetX;
        let y1 = (pos.y) - resRect.svg.y - rectOffsetY;

        rect1.setAttribute("transform", `translate(${x1} ${y1})`);


    }


</script>


</body>
</html>









